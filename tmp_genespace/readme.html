<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="JTLovell" />

<meta name="date" content="2018-05-25" />

<title>README</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">README</h1>
<h4 class="author"><em>JTLovell</em></h4>
<h4 class="date"><em>2018-05-25</em></h4>



<div id="setup" class="section level1">
<h1>Setup</h1>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>To install the compareGeneSpace R package, first clone it to a local directory or download the zipball and uncompress it. Then install it via devtools, or whatever other method you use. For example:</p>
<p><code>R devtools::install(&quot;~/Downloads/compareGeneSpace-master&quot;)</code>, then <code>R library(compareGeneSpace)</code>.</p>
<p>Now, the package is available for use.</p>
</div>
<div id="installation-of-dependencies" class="section level2">
<h2>Installation of dependencies</h2>
<p>For now, the program requires a path to the programs on which it depends. This includes:</p>
<ol style="list-style-type: decimal">
<li>Diamond (aligner)</li>
<li>MCScanX (collinear block finder)</li>
<li>Concorde (TSP solver to accurately split up blocks)</li>
</ol>
<p>Install these programs locally and provide the path to the executable to R</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Concorde.path =<span class="st"> &quot;/Users/jlovell/Documents/comparative_genomics/programs/concorde/TSP/&quot;</span>
MCScanX.path =<span class="st"> &quot;/Users/jlovell/Documents/comparative_genomics/programs/MCScanX&quot;</span>
Diamond.path =<span class="st"> &quot;/Users/jlovell/Documents/comparative_genomics/programs/diamond/</span></code></pre></div>
</div>
<div id="setting-up-directories" class="section level2">
<h2>Setting up directories</h2>
<p>To get started, we need to build a set of directories that contain:</p>
<p><code>peptide.dir</code> - fasta-formatted peptide sequences, one/gene for the primary transcript <code>gff.dir</code> - gff3-formatted annotations for each genome <code>mappings.dir</code> - an empty directory that stores the blast mappings <code>mcscan.dir</code> - an empty directory that will contain the MCScanX input files</p>
</div>
<div id="formatting-peptide-fastas" class="section level2">
<h2>Formatting peptide fastas</h2>
<p>The names in the peptide files are used to match metdata. These need to be exactly: genomeID.pep.fa. So, for the Sviridis genome, the peptide fasta is Sviridis.pep.fa. This is case sensitive.</p>
<p>The peptide headers must exactly match the gff entries title <code>gene</code>. Typically, peptide fastas have a number of identifiers in the headers for each sequence. These need to be parsed and stripped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_fastaHeader</span>(<span class="dt">fasta.dir =</span> peptide.dir, <span class="dt">is.peptide =</span> T,
                  <span class="dt">pattern =</span> <span class="st">&quot;pep.fa&quot;</span>, <span class="dt">verbose =</span> T)</code></pre></div>
</div>
<div id="gff-files" class="section level2">
<h2>Gff files</h2>
<p>The gff files do not need to be parsed beforehand, they are done internally. Ensure that the gene entries (rows) are labeled “gene” in the third column and the locus identifier in the 9th column matches the fasta headers. If formats are standard, this will be done automatically.</p>
</div>
<div id="metadata" class="section level2">
<h2>Metadata</h2>
<p>To run the pipeline we need to know more about the genomes. In particular, we need to set 2-character unique abbreviations and ploidy for each genome. These are supplied in a list</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">abbrev.dict =<span class="st"> </span><span class="kw">list</span>(<span class="dt">Phallii =</span> <span class="st">&quot;Pa&quot;</span>,
                   <span class="dt">PhalliiHAL =</span> <span class="st">&quot;Ph&quot;</span>,
                   <span class="dt">Sviridis =</span> <span class="st">&quot;Sv&quot;</span>,
                   <span class="dt">Sbicolor =</span> <span class="st">&quot;Sb&quot;</span>,
                   <span class="dt">Pvirgatum =</span> <span class="st">&quot;Pv&quot;</span>)
ploidy.dict =<span class="st"> </span><span class="kw">list</span>(<span class="dt">Phallii =</span> <span class="dv">2</span>,
                   <span class="dt">PhalliiHAL =</span> <span class="dv">2</span>,
                   <span class="dt">Sviridis =</span> <span class="dv">2</span>,
                   <span class="dt">Sbicolor =</span> <span class="dv">2</span>,
                   <span class="dt">Pvirgatum =</span> <span class="dv">4</span>)</code></pre></div>
<p>We then concatenate all input data into a single matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id.mat =<span class="st"> </span><span class="kw">make_inputFileMatrix</span>(
  <span class="dt">peptide.dir =</span> <span class="st">&quot;/Users/jlovell/Documents/comparative_genomics/peptide&quot;</span>,
  <span class="dt">mappings.dir =</span> <span class="st">&quot;/Users/jlovell/Documents/comparative_genomics/mappings&quot;</span>,
  <span class="dt">gff.dir =</span> <span class="st">&quot;/Users/jlovell/Documents/comparative_genomics/gff&quot;</span>,
  <span class="dt">mcscan.dir =</span> <span class="st">&quot;/Users/jlovell/Documents/comparative_genomics/mcs_mapping&quot;</span>,
  <span class="dt">ploidy.dict =</span> ploidy.dict,
  <span class="dt">abbrev.dict =</span> abbrev.dict,
  <span class="dt">ref.id =</span> <span class="st">&quot;PhalliiHAL&quot;</span>)</code></pre></div>
</div>
</div>
<div id="pairwise-mappings" class="section level1">
<h1>Pairwise mappings</h1>
<p>To save time in mapping, we do not conduct all intra-genome pairwise mappings. Instead, we focus on a single reference genome, supplied above to <code>ref.id</code>. In this example, all unique pairwise inter-genome mappings will be conducted, but only PhalliiHAL will be mapped to itself. If all intra-genome mappings are allowed, it can be A) very slow for polyploids and B) produce mapping files that are huge.</p>
<p>To execute pairwise mapping, we pipe our fastas into Diamond:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mappings =<span class="st"> </span><span class="kw">pipe_Diamond2MCScanX</span>(<span class="dt">inputFileMatrix =</span> id.mat,
                                <span class="dt">mcscan.dir =</span> mcscan.dir,
                                <span class="dt">nthreads =</span> <span class="dv">6</span>, <span class="dt">onlyParseMap =</span> F)</code></pre></div>
<p>This runs four steps for each pair of reciprocal mapping fastas:</p>
<ol style="list-style-type: decimal">
<li>Make a database for the reference genome (or a random alternate genome if the reference is not one of the pairs)</li>
<li>Map the alternative fasta to the reference database</li>
<li>Parse the output to dense regions</li>
<li>Format for MCScan</li>
</ol>
</div>
<div id="collinear-block-construction" class="section level1">
<h1>Collinear block construction</h1>
<p>To build collinear blocks, we feed the parsed mapping file into MCScanX. MCScanX’s block building is generally good, but it gets confused by local inversions in an otherwise collinear region. Because of this, we cannot only use MCScanX, but must parse the ouput. To conduct this, we run the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">init.mcscan2 =<span class="st"> </span><span class="kw">run_MCScanX</span>(<span class="dt">ref.id =</span> <span class="st">&quot;PhalliiHAL&quot;</span>,
                           <span class="dt">mapping.obj =</span> mappings,
                           <span class="dt">MCScanX.path =</span> MCScanX.path,
                           <span class="dt">mcs_mapping.dir =</span> mcscan.dir,
                           <span class="dt">MCScanX.params =</span> <span class="st">&quot;-a -s 5 -m 10&quot;</span>, <span class="dt">plotit =</span> T,
                           <span class="dt">altGenome2plot =</span> <span class="st">&quot;Sviridis&quot;</span>,
                           <span class="dt">chr1toplot =</span> <span class="kw">c</span>(<span class="st">&quot;Chr08&quot;</span>),
                           <span class="dt">chr2toplot =</span> <span class="kw">c</span>(<span class="st">&quot;Chr_08&quot;</span>),
                           <span class="dt">buffer =</span> <span class="dv">1</span>)

parsed_mcscan =<span class="st"> </span><span class="kw">split_blocksByTSP</span>(<span class="dt">map =</span> init.mcscan2<span class="op">$</span>map,
                                  <span class="dt">Concorde.path =</span> Concorde.path,
                                  <span class="dt">max.jump =</span> <span class="dv">5</span>)</code></pre></div>
<p>The first step builds collinear blocks through <code>MCScanX</code>, then merges overlapping blocks (that are buffer rank-orders away).</p>
<p>The second step is slow and is optional. It requires the <code>TSP R package</code> and the underlying <code>Concorde</code> TSP solver. For each block it asks if neighboring genes are <code>max.jump</code> apart. If so, it splits the block accordingly. It will also toss mappings that appear to be non-colinear.</p>
</div>
<div id="stopped-here" class="section level1">
<h1>Stopped here</h1>
</div>
<div id="re-mapping-within-blocks" class="section level1">
<h1>Re-mapping within blocks</h1>
<p>Subset fastas by block coordinates Reciprocal blasts for each pairwise block</p>
</div>
<div id="find-orthologous-groups-in-blocks" class="section level1">
<h1>Find orthologous groups in blocks</h1>
<p>orthofinder</p>
</div>
<div id="find-un-annotated-sequences" class="section level1">
<h1>Find un-annotated sequences</h1>
<p>either local (between neighboring genes) or global (within the entire block) mapping of remaining peptides to assembly.</p>
<p>define region of best hits and do quick and dirty local alignment. Pull fasta from quick alignment.</p>
<p>Write sequences without satisfactory alignments to file</p>
</div>
<div id="align-all-sequences" class="section level1">
<h1>Align all sequences</h1>
<p>Make mapping file across pairwise reciprocal hits Concatenate sequences for each mapping cluster into a single file Convert peptide to DNA Conduct alignments with mafft Write alignments to file</p>
</div>
<div id="annotate-alignments" class="section level1">
<h1>Annotate alignments</h1>
<p>…</p>
<div id="using-conda" class="section level2">
<h2>Using conda</h2>
<p>This is not implemented yet, but will be.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">conda</span> create --yes --name comparegenespace diamond concorde R r-argparser r-data.table r-devtools bioconductor-rsamtools bioconductor-genomicfeatures bioconductor-genomicalignments bioconductor-biostrings bioconductor-rtracklayer bioconductor-GenomeInfoDb bioconductor-genomicranges</code></pre></div>
<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com" class="uri">http://rmarkdown.rstudio.com</a>.</p>
<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(cars)</code></pre></div>
</div>
<div id="including-plots" class="section level2">
<h2>Including Plots</h2>
<p>You can also embed plots, for example:</p>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
