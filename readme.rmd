---
title: "README"
author: "JTLovell"
date: "9/11/2018"
output: html_document
---
# Overview

A common goal in comparative genomics is to compare gene sequences of many species with reference to the ancestral state. While simple in highly conserved, single copy genes and dipliod/haploid organisms, such alignments are tricky when extending to the biological complexity of most genomes. 

Here, we develop a pipeline to accomplish alignemnts in "gene space" (within, or near gene models) to gain a more complete picture of genomic polymorphism among species. The approach can handle any ploidy, ancient or recent whole-genome duplicates, inversions (and other small-scale rearangements) and most other known complexity. Such flexibility is affordered by accomplishing basic comparative genomes tasks within collinear blocks. Once the blocks are constructed, any basic task can be accomplished, knowing that one is comparing evolutionarily related, diploid sequences. 

## General pipeline

1. pairwise blast search --> colinear blocks of genes
2. orthofinder within colinear blocks --> genes missing in at least one genome
3. blat search within blocks for orthologs of missing genes --> regions containing missing sequence
4. exonerate missing sequence --> pseudo-CDS of unannotated sequence
5. multiple sequence alignemnt of all sequences --> sequence divergence statistics

## Outputs

1. List of single copy orthologs between each pair of genomes
2. List of genes without orthologous sequences in each genome
3. Mapping file with the positions of genes in colinear blocks between each pair of genomes
4. Block file with coordinates of collinear blocks between each pair of genomes
3. Multiple sequence alignments for each orthogroup (tested within colinear blocks)

# Getting started

## Input data

Each genome must have five datasets

1. Annotation file (gff3 format)
2. Peptide fasta file of the primary transcript for each gene
3. CDS fasta file of the primary transcript for each gene
4. Full-length transcript fasta file of the primary transcript for each gene
5. Genomic assembly fasta

To get started, make a project directory, e.g.:

`mkdir /Users/jlovell/Desktop/grass_genespace`
`cd /Users/jlovell/Desktop/grass_genespace`

Then make two raw data subdirectories, e.g.: 

`mkdir raw_annotations`
`mkdir raw_assemblies`

Copy all the assembly fasta files into the raw_assemblies directory and rename them as `[genomeID].fa`. 

Make a subdirectory named [genomeID] for each `genomeID` in the raw_annotations directory. Place the four annotation files of each genomeID into the respective subdirectories. It doesn't matter what the annotations are named, as long as there is a distinguishing character string in each file name that identifies the type of annotation file. For example, the CDS fastas may all have `cds_primaryTranscriptOnly` in their names. 


## Conda environment

Create the conda environment with the basic programs that are required
```
conda create -p $SCRATCH/conda_envs/genespace python=2.7 orthofinder samtools diamond blat bedtools R
source activate genespace
```

Install the required R packages

```
conda install -c bioconda bioconductor-biostrings bioconductor-genomicfeatures bioconductor-rsamtools
conda install -c r r-devtools r-data.table
```

I recommend running this in R studio, but not necessary. If you want to and don't have Rstudio installed:

```
conda install rstudio
```

Install MCScanX from http://chibba.pgml.uga.edu/mcscan2/MCScanX.zip,

If having trouble with installation, see troubleshooting here: https://vcru.wisc.edu/simonlab/bioinformatics/programs/install/mcscanx.htm

Then specify the path to MCSCanX:
``` 
export PATH=$PATH:/global/homes/j/jtlovell/MCScanX
```


Otherwise 

```
open -na Rstudio
R
```

Within R, install the GENESPACE package

```
> library(devtools)
> devtools::install_github("HudsonAlpha/GENESPACE",
               auth_token = "6ad39f2df35eff7a5a4990a1abead1ea74dd33dc")

> library(GENESPACE)
```

## Automatic formatting of input data

GENESPACE requires a very specific naming and file structure of the input data ... within the project directory, there needs to be a folder called `genomes`. This contains five subdirectories:

1. assembly
2. peptide
3. cds
4. transcript
5. gff

Each of these needs to be populated with a file for each genome named [genomeID].fa, or [genomeID].gff3. Making these files can be annoying, so there is a conveniece function:

```
> 










